<div class="flex items-center justify-between mb-6">
  <h1 class="text-2xl font-bold text-gray-900">Contacts</h1>
  <%= render "ui/button", label: "Export CSV", href: export_contacts_path, variant: :secondary, size: :sm %>
</div>

<div class="mb-6">
  <%= form_with url: contacts_path, method: :get, data: { turbo_action: "advance" } do |f| %>
    <div class="flex gap-2">
      <input type="text" name="q" value="<%= params[:q] %>" placeholder="Search by name or email..."
        class="block w-full rounded-lg border-0 py-2 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-gray-900 sm:text-sm sm:leading-6">
      <%= render "ui/button", label: "Search", type: "submit", variant: :secondary, size: :sm %>
    </div>
  <% end %>
</div>

<% if @contacts.any? %>
  <%= render layout: "ui/card" do %>
    <div class="-mx-6 -my-4 overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bookings</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Booked</th>
            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"></th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @contacts.each do |contact| %>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><%= contact.name %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><%= contact.email %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><%= contact.total_bookings_count %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <%= contact.last_booked_at&.strftime("%b %-d, %Y") || "Never" %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm">
                <%= link_to "View", contact_path(contact), class: "text-gray-600 hover:text-gray-900 font-medium" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
<% else %>
  <%= render "ui/empty_state",
    title: "No contacts found",
    description: "Contacts are created automatically when someone books a meeting." %>
<% end %>
